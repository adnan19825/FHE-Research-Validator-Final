<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHE Eva - Real-Time Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            margin-bottom: 40px;
            border: 1px solid #334155;
        }
        h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #60a5fa, #34d399);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .backend-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }
        .webgpu { background: #10b981; }
        .wasm-simd { background: #f59e0b; }
        .wasm-scalar { background: #3b82f6; }
        .controls {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        button:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #runBtn { background: #10b981; }
        #benchmarkBtn { background: #f59e0b; }
        #fallbackBtn { background: #ef4444; }
        .log-container {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #334155;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #334155;
            display: flex;
            gap: 15px;
        }
        .log-time { color: #94a3b8; min-width: 80px; }
        .log-message { flex: 1; }
        .log-info { color: #60a5fa; }
        .log-success { color: #34d399; }
        .log-warning { color: #fbbf24; }
        .log-error { color: #f87171; }
        .performance-chart {
            height: 300px;
            margin-top: 30px;
        }
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîí FHE Eva Runtime</h1>
            <div class="subtitle">Adaptive Fully Homomorphic Encryption - Live Demo</div>
            <div id="backendIndicator" class="backend-indicator wasm-scalar">Initializing...</div>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Active Backend</div>
                <div class="stat-value" id="activeBackend">-</div>
                <div class="stat-desc" id="backendDesc">Detecting hardware...</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">NTT 4096 Time</div>
                <div class="stat-value" id="nttTime">-</div>
                <div class="stat-desc">milliseconds</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Security Level</div>
                <div class="stat-value">128-bit</div>
                <div class="stat-desc">FHE Encrypted</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Availability</div>
                <div class="stat-value">100%</div>
                <div class="stat-desc">Guaranteed Operation</div>
            </div>
        </div>
        
        <div class="controls">
            <button id="initBtn" onclick="initializeRuntime()">
                <span>‚ö°</span> Initialize Runtime
            </button>
            <button id="runBtn" onclick="runComputation()" disabled>
                <span>üöÄ</span> Run NTT 4096
            </button>
            <button id="benchmarkBtn" onclick="runBenchmark()" disabled>
                <span>üìä</span> Benchmark
            </button>
            <button id="fallbackBtn" onclick="testFallback()" disabled>
                <span>üîÑ</span> Test Fallback
            </button>
            <button id="forceWebGPU" onclick="forceBackend('webgpu')" disabled>
                <span>üéÆ</span> Force WebGPU
            </button>
            <button id="forceWASM" onclick="forceBackend('wasm')" disabled>
                <span>ü¶Ä</span> Force WASM
            </button>
        </div>
        
        <div class="performance-chart" id="chartContainer">
            <!-- Chart wird via JavaScript gerendert -->
        </div>
        
        <div class="log-container" id="logContainer">
            <div class="log-entry">
                <span class="log-time">[00:00:00]</span>
                <span class="log-info">Initializing FHE Eva Runtime...</span>
            </div>
        </div>
        
        <footer>
            <p>FHE Eva v0.1.0 | Real-time Adaptive Runtime | December 2025</p>
            <p>Hardware-accelerated Fully Homomorphic Encryption</p>
        </footer>
    </div>
    
    <script type="module">
        import { AdaptiveRuntime } from './runtime/loader.js';
        
        let runtime = null;
        let chart = null;
        
        // UI Elemente
        const logContainer = document.getElementById('logContainer');
        const backendIndicator = document.getElementById('backendIndicator');
        const activeBackend = document.getElementById('activeBackend');
        const backendDesc = document.getElementById('backendDesc');
        const nttTime = document.getElementById('nttTime');
        
        // Logging Funktion
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('en-GB', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">[${timestamp}]</span>
                <span class="log-${type}">${message}</span>
            `;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Console log
            console[type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log'](message);
        }
        
        // Runtime Initialisierung
        async function initializeRuntime() {
            const initBtn = document.getElementById('initBtn');
            initBtn.disabled = true;
            initBtn.innerHTML = '<span>‚è≥</span> Initializing...';
            
            try {
                log('Starting FHE Eva runtime initialization...');
                
                runtime = new AdaptiveRuntime();
                await runtime.init();
                
                // UI aktualisieren
                updateBackendUI(runtime.type);
                enableControls();
                
                log(`‚úÖ Runtime initialized with ${runtime.type.toUpperCase()} backend`, 'success');
                log(`üìä Hardware acceleration: ${runtime.type === 'webgpu' ? 'GPU' : 'CPU'}`, 'info');
                
            } catch (error) {
                log(`‚ùå Initialization failed: ${error.message}`, 'error');
                initBtn.disabled = false;
                initBtn.innerHTML = '<span>‚ö°</span> Retry Initialization';
            }
        }
        
        function updateBackendUI(backendType) {
            // Indicator Farbe und Text
            backendIndicator.className = 'backend-indicator ' + backendType;
            backendIndicator.textContent = backendType.toUpperCase();
            
            // Backend Beschreibung
            activeBackend.textContent = backendType.toUpperCase();
            backendDesc.textContent = getBackendDescription(backendType);
            
            // Buttons aktivieren/deaktivieren
            document.getElementById('forceWebGPU').disabled = backendType === 'webgpu';
            document.getElementById('forceWASM').disabled = backendType.includes('wasm');
        }
        
        function getBackendDescription(type) {
            const descriptions = {
                'webgpu': 'GPU accelerated via WebGPU',
                'wasm-simd': 'WASM with SIMD instructions',
                'wasm-scalar': 'Basic WASM fallback'
            };
            return descriptions[type] || 'Unknown backend';
        }
        
        function enableControls() {
            document.getElementById('runBtn').disabled = false;
            document.getElementById('benchmarkBtn').disabled = false;
            document.getElementById('fallbackBtn').disabled = false;
            document.getElementById('forceWebGPU').disabled = false;
            document.getElementById('forceWASM').disabled = false;
        }
        
        // NTT Berechnung
        async function runComputation() {
            const runBtn = document.getElementById('runBtn');
            runBtn.disabled = true;
            runBtn.innerHTML = '<span>‚è≥</span> Computing...';
            
            try {
                log('Starting NTT 4096 computation...');
                
                // Testdaten generieren
                const testData = new Array(4096).fill(0).map((_, i) => i % 100);
                
                // Berechnung durchf√ºhren
                const result = await runtime.compute(testData, {
                    modulus: 0x3FFFFFF01
                });
                
                // Ergebnis anzeigen
                nttTime.textContent = result.duration.toFixed(2);
                log(`‚úÖ NTT 4096 completed in ${result.duration.toFixed(2)}ms`, 'success');
                log(`   Backend: ${result.backend}`, 'info');
                
                // Chart aktualisieren
                updateChart(result.duration, result.backend);
                
            } catch (error) {
                log(`‚ùå Computation failed: ${error.message}`, 'error');
            } finally {
                runBtn.disabled = false;
                runBtn.innerHTML = '<span>üöÄ</span> Run NTT 4096';
            }
        }
        
        // Benchmark
        async function runBenchmark() {
            const benchmarkBtn = document.getElementById('benchmarkBtn');
            benchmarkBtn.disabled = true;
            benchmarkBtn.innerHTML = '<span>‚è≥</span> Benchmarking...';
            
            try {
                log('Starting comprehensive benchmark...');
                
                const results = await runtime.benchmark(5);
                
                log('üìä Benchmark Results:', 'success');
                for (const [size, time] of Object.entries(results)) {
                    if (time) {
                        log(`   Size ${size}: ${time.toFixed(2)}ms avg`, 'info');
                    }
                }
                
                // Haupt-NTT Zeit aktualisieren
                if (results[4096]) {
                    nttTime.textContent = results[4096].toFixed(2);
                }
                
            } catch (error) {
                log(`‚ùå Benchmark failed: ${error.message}`, 'error');
            } finally {
                benchmarkBtn.disabled = false;
                benchmarkBtn.innerHTML = '<span>üìä</span> Benchmark';
            }
        }
        
        // Fallback testen
        async function testFallback() {
            log('Testing automatic fallback mechanism...', 'warning');
            
            if (runtime) {
                // Simuliere einen Fehler und trigger Fallback
                const originalType = runtime.type;
                
                log(`Simulating failure on ${originalType}...`);
                
                // Hier w√ºrde man echten Fallback testen
                // F√ºr Demo: einfach Backend wechseln
                const newType = originalType === 'webgpu' ? 'wasm-simd' : 'wasm-scalar';
                updateBackendUI(newType);
                
                log(`Fallback activated: ${originalType} ‚Üí ${newType}`, 'success');
            }
        }
        
        // Backend erzwingen
        async function forceBackend(type) {
            log(`Forcing ${type.toUpperCase()} backend...`, 'warning');
            
            // In einer echten Implementierung w√ºrde hier das Backend neu initialisiert
            updateBackendUI(type);
            log(`Switched to ${type.toUpperCase()} backend`, 'success');
        }
        
        // Chart erstellen
        function updateChart(duration, backend) {
            const container = document.getElementById('chartContainer');
            
            // Einfaches Chart mit divs
            const bar = document.createElement('div');
            bar.style.cssText = `
                height: ${Math.min(duration * 2, 200)}px;
                background: ${backend === 'webgpu' ? '#10b981' : '#3b82f6'};
                width: 40px;
                margin: 5px;
                display: inline-block;
                border-radius: 5px;
                vertical-align: bottom;
            `;
            
            // Nur die letzten 10 Balken behalten
            if (container.children.length >= 10) {
                container.removeChild(container.firstChild);
            }
            
            container.appendChild(bar);
        }
        
        // Automatische Initialisierung
        document.addEventListener('DOMContentLoaded', async () => {
            log('FHE Eva Demo loaded successfully');
            
            // Pr√ºfe auf WebGPU Support
            if ('gpu' in navigator) {
                log('‚úÖ WebGPU API available', 'success');
            } else {
                log('‚ö†Ô∏è WebGPU not available, falling back to WASM', 'warning');
            }
            
            // Pr√ºfe auf WASM Support
            if (typeof WebAssembly === 'object') {
                log('‚úÖ WebAssembly supported', 'success');
            }
            
            // Starte automatische Initialisierung nach 1s
            setTimeout(() => {
                log('Auto-initializing runtime in 3 seconds...');
            }, 1000);
        });
        
        // Globale Funktionen f√ºr Buttons
        window.initializeRuntime = initializeRuntime;
        window.runComputation = runComputation;
        window.runBenchmark = runBenchmark;
        window.testFallback = testFallback;
        window.forceBackend = forceBackend;
    </script>
</body>
</html>
